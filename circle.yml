machine:
  services:
    - redis
    - docker
  node:
    version: 6.5.0

dependencies:
  post:
    - npm install sqlite3
    - docker build --rm=false -t $AWS_ACCOUNT_ID.dkr.ecr.AWS_DEFAULT_REGION.amazonaws.com/hotvenue-server:$CIRCLE_SHA1 .

test:
  post:
    - docker run -d -p 3000:3000 $AWS_ACCOUNT_ID.dkr.ecr.AWS_DEFAULT_REGION.amazonaws.com/hotvenue-server:$CIRCLE_SHA1
    - sleep 20
    - curl --retry 10 --retry-delay 5 -v http://localhost:3000
